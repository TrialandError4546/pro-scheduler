<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis Pro Scheduler</title>
    <!-- Tailwind CSS for a clean, modern look -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal {
            display: none;
        }
        .modal.open {
            display: flex;
        }
    </style>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBMA3OjbUnX2c786WxFtDdWs7jzTfDFUqE",
            authDomain: "master-ntc-scheduler.firebaseapp.com",
            projectId: "master-ntc-scheduler",
            storageBucket: "master-ntc-scheduler.firebasestorage.app",
            messagingSenderId: "756847124761",
            appId: "1:756847124761:web:4d77e91da2cf31b385a588",
            measurementId: "G-CXP60P9M3Q"
        };
        
        // Use projectId as appId for a more reliable identifier outside of Canvas
        const appId = firebaseConfig.projectId;

        // Initialize Firebase services
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let userId = null;
        let proRatings = [];
        let proAvailability = [];
        let processedScheduleData = [];

        // Hardcoded schedule data from the PDF for Monday
        const schedule = [
            { court: 1, name: 'Round Robin', time: '10:00A-11:30A', rating: 'None', pro: null },
            { court: 1, name: 'Round Robin', time: '11:30A-1:00P', rating: 'None', pro: null },
            { court: 1, name: 'FTF', time: '4:00P-6:00P', rating: 'None', pro: null },
            { court: 1, name: 'Intro To Tennis', time: '6:00P-7:30P', rating: 'None', pro: null },
            { court: 1, name: 'Night Lights', time: '7:30P-9:00P', rating: 'Gold', pro: null },
            { court: 2, name: 'Round Robin', time: '10:00A-11:30A', rating: 'None', pro: null },
            { court: 2, name: 'Round Robin', time: '11:30A-1:00P', rating: 'None', pro: null },
            { court: 2, name: 'FTF', time: '4:00P-6:00P', rating: 'None', pro: null },
            { court: 2, name: 'Drill & Play', time: '6:00P-8:00P', rating: 'Bronze', pro: null },
            { court: 2, name: 'Zone', time: '8:00P-9:30P', rating: 'None', pro: null },
            { court: 3, name: 'Round Robin', time: '10:00A-11:30A', rating: 'None', pro: null },
            { court: 3, name: 'Round Robin', time: '11:30A-1:00P', rating: 'None', pro: null },
            { court: 3, name: 'Elite', time: '4:00P-6:00P', rating: 'None', pro: null },
            { court: 3, name: 'Drill & Play', time: '6:00P-8:00P', rating: 'Bronze', pro: null },
            { court: 3, name: 'Zone', time: '8:00P-9:30P', rating: 'None', pro: null },
            { court: 4, name: 'Round Robin', time: '10:00A-11:30A', rating: 'None', pro: null },
            { court: 4, name: 'Round Robin', time: '11:30A-1:00P', rating: 'None', pro: null },
            { court: 4, name: 'Elite', time: '4:00P-6:00P', rating: 'None', pro: null },
            { court: 4, name: 'JD Stars', time: '6:30P-8:00P', rating: 'None', pro: null },
            { court: 4, name: 'NTC Silver', time: '8:00P-9:30P', rating: 'Silver', pro: null },
            { court: 5, name: 'Round Robin', time: '10:00A-11:30A', rating: 'None', pro: null },
            { court: 5, name: 'Round Robin', time: '11:30A-1:00P', rating: 'None', pro: null },
            { court: 5, name: 'JR Stroke Series', time: '5:00P-6:00P', rating: 'None', pro: null },
            { court: 5, name: 'Green Champs', time: '6:00P-8:00P', rating: 'None', pro: null },
            { court: 5, name: 'NTC Bronze', time: '8:00P-9:30P', rating: 'Bronze', pro: null },
            { court: 6, name: 'Round Robin', time: '10:00A-11:30A', rating: 'None', pro: null },
            { court: 6, name: 'Round Robin', time: '11:30A-1:00P', rating: 'None', pro: null },
            { court: 6, name: 'JR Stroke Series', time: '5:00P-6:00P', rating: 'None', pro: null },
            { court: 6, name: 'Green Champs', time: '6:00P-8:00P', rating: 'None', pro: null },
            { court: 6, name: 'NTC Bronze', time: '8:00P-9:30P', rating: 'Bronze', pro: null },
            { court: 7, name: 'Novice 102', time: '9:00A-10:30A', rating: 'None', pro: null },
            { court: 7, name: 'Lead Pro', time: '10:30A-12:00P', rating: 'Bronze', pro: null },
            { court: 7, name: 'Advanced Zone', time: '12:00P-1:30P', rating: 'None', pro: null },
            { court: 7, name: 'Red Aces', time: '4:00P-5:30P', rating: 'None', pro: null },
            { court: 7, name: 'Orange Champs', time: '5:30P-7:00P', rating: 'None', pro: null },
            { court: 7, name: 'NTC Rally', time: '7:00P-8:30P', rating: 'None', pro: null },
            { court: 7, name: 'Intro to Tennis', time: '8:30P-10:00P', rating: 'None', pro: null },
            { court: 8, name: 'NTC Rally', time: '9:00A-10:30A', rating: 'None', pro: null },
            { court: 8, name: 'Lead Pro', time: '10:30A-12:00P', rating: 'Bronze', pro: null },
            { court: 8, name: 'Orange Aces', time: '4:00P-5:30P', rating: 'None', pro: null },
            { court: 8, name: 'Green Aces', time: '5:30P-7:00P', rating: 'None', pro: null },
            { court: 8, name: 'NTC Rally', time: '7:00P-8:30P', rating: 'None', pro: null },
            { court: 8, name: 'Stroke Series', time: '8:30P-9:30P', rating: 'None', pro: null },
            { court: 9, name: 'NTC Rally', time: '9:00A-10:30A', rating: 'None', pro: null },
            { court: 9, name: 'Eval', time: '5:00P-5:30P', rating: 'None', pro: null },
            { court: 9, name: 'Jr expansion', time: '5:30P-7:00P', rating: 'None', pro: null },
            { court: 9, name: 'NTC Rally', time: '7:00P-8:30P', rating: 'None', pro: null },
            { court: 9, name: 'Stroke Series', time: '8:30P-9:30P', rating: 'None', pro: null },
            { court: 10, name: 'Drill & Play', time: '10:00A-11:30A', rating: 'Silver', pro: null },
            { court: 10, name: 'Green Stars', time: '5:00P-7:00P', rating: 'None', pro: null },
            { court: 10, name: 'Novice 102', time: '7:00P-8:30P', rating: 'None', pro: null },
            { court: 11, name: 'Drill & Play', time: '10:00A-11:30A', rating: 'Silver', pro: null },
            { court: 11, name: 'Novice 102', time: '7:00P-8:30P', rating: 'None', pro: null },
            { court: 12, name: 'NTC Gold', time: '7:00P-8:30P', rating: 'Gold', pro: null },
        ];

        // Hardcoded default pro ratings
        const proRatingsDefault = JSON.stringify([
            { "name": "Nouri", "ratings": ["Red", "Orange", "Green", "Intro/Novice"] },
            { "name": "John", "ratings": ["JD Aces Plus (14-18)", "JD Champs", "JD Aces (10-14)", "JD Stars", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "Wheelchair"] },
            { "name": "Justyna", "ratings": ["Red", "Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "All FT", "Wheelchair"] },
            { "name": "Osas", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "All FT", "Seniors", "Fitness"] },
            { "name": "David", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "All FT", "Seniors", "Fitness"] },
            { "name": "Karla", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "All FT"] },
            { "name": "Danny", "ratings": ["Orange", "JD Aces Plus (14-18)", "JD Champs", "JD Aces (10-14)", "FTF", "High Performance (FTF +, Elite)", "All FT", "PACES**"] },
            { "name": "Zack", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "All FT"] },
            { "name": "Steven", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "All FT"] },
            { "name": "Gus", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "PACES**"] },
            { "name": "Alex H. (Assist)", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "High Performance (FTF +, Elite)", "Intro/Novice", "Rally/Bronze", "Silver/Gold"] },
            { "name": "Omer", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold"] },
            { "name": "Anders", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Wheelchair", "Seniors"] },
            { "name": "Peter", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "PACES**", "Wheelchair", "Seniors"] },
            { "name": "Farhad", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold"] },
            { "name": "Jinny", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Intro/Novice", "Rally/Bronze", "Silver/Gold", "All FT"] },
            { "name": "Viola (Assist)", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Rally/Bronze"] },
            { "name": "Daniel C.", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Rally/Bronze", "Silver/Gold"] },
            { "name": "Shaquille", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Rally/Bronze", "Silver/Gold"] },
            { "name": "Will (Assist)", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Rally/Bronze", "Silver/Gold"] },
            { "name": "Robert", "ratings": ["JD Aces Plus (14-18)", "JD Champs", "FTF", "Silver/Gold"] },
            { "name": "Felix", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF", "Rally/Bronze", "Silver/Gold", "All FT"] },
            { "name": "Petra (Assist)", "ratings": ["Orange", "Green", "JD Aces Plus (14-18)", "JD Champs", "FTF"] },
            { "name": "Rohan", "ratings": ["JD Aces Plus (14-18)", "JD Champs", "FTF", "Rally/Bronze", "Silver/Gold"] },
            { "name": "Orlando", "ratings": ["JD Aces Plus (14-18)", "JD Champs", "FTF", "Rally/Bronze", "Silver/Gold", "All FT"] }
        ], null, 2);

        // Hardcoded default pro availability from the CSV
        const proAvailabilityDefault = JSON.stringify([
            { "name": "David Parra-Newton", "availability": [{ "time": "4:00P-9:30P" }] },
            { "name": "Leo Correa", "availability": [{ "time": "11:30A-3:30P" }] },
            { "name": "Shaquille Hamilton", "availability": [{ "time": "8:30A-3:00P" }] },
            { "name": "Valery Cardona", "availability": [{ "time": "9:00A-4:00P" }] },
            { "name": "Mellanie Benitez", "availability": [{ "time": "9:00A-4:00P" }] },
            { "name": "John Warren", "availability": [{ "time": "OFF NEW" }] },
            { "name": "Rod Bailey", "availability": [{ "tim
