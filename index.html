<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pro Staff Scheduler</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="app" class="p-6 text-white bg-gray-900 min-h-screen">
    <h1 class="text-3xl font-bold mb-4">Pro Staff Scheduler</h1>
    <div id="category-tabs" class="mb-4"></div>
    <div id="day-tabs" class="mb-4"></div>
    <div id="schedule-container">Loading...</div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
    import { getFirestore, collection, doc, getDocs, setDoc, getDoc, query } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyAuIqhrh4KbvRyB07UB-NvDz5dK-XRFAW0",
      authDomain: "ntc-pro-scheduler.firebaseapp.com",
      projectId: "ntc-pro-scheduler",
      storageBucket: "ntc-pro-scheduler.appspot.com",
      messagingSenderId: "405568766027",
      appId: "1:405568766027:web:b4f61ffb74458a61270dce",
      measurementId: "G-1HQ35F9F6N"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const currentCategory = 'Daytime';
    const currentDay = 'Monday';
    const currentWeekDate = '9/15';
    const scheduleContainer = document.getElementById('schedule-container');

    const fetchSchedule = async () => {
      const weeksCollection = collection(db, 'schedules', 'ntc-pro-scheduler', 'weeks');
      const querySnapshot = await getDocs(query(weeksCollection));
      let scheduleState = {};

      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const uniqueClassKey = `${data.className}___${data.time}`;
        if (!scheduleState[data.category]) scheduleState[data.category] = {};
        if (!scheduleState[data.category][data.day]) scheduleState[data.category][data.day] = {};
        if (!scheduleState[data.category][data.day][uniqueClassKey]) {
          scheduleState[data.category][data.day][uniqueClassKey] = { weeklyAssignments: {} };
        }
        scheduleState[data.category][data.day][uniqueClassKey].weeklyAssignments[data.date] = {
          pros: data.pros || [],
          availablePros: data.availablePros || [],
          court: data.court || null
        };
      });

      renderSchedule(scheduleState);
    };

    const renderSchedule = (scheduleState) => {
      scheduleContainer.innerHTML = '';
      const classes = scheduleState[currentCategory]?.[currentDay];
      if (!classes) {
        scheduleContainer.innerHTML = '<p>No schedule found for selected category and day.</p>';
        return;
      }

      for (const key in classes) {
        const [className, time] = key.split('___');
        const weekData = classes[key].weeklyAssignments[currentWeekDate];
        if (!weekData || !weekData.court) continue;

        const card = document.createElement('div');
        card.className = 'bg-gray-800 p-4 rounded-lg mb-4';
        card.innerHTML = `
          <h2 class="text-xl font-bold mb-2">${className}</h2>
          <p><strong>Time:</strong> ${time}</p>
          <p><strong>Court:</strong> ${weekData.court}</p>
          <p><strong>Pros:</strong> ${weekData.pros.join(', ') || 'Unassigned'}</p>
        `;
        scheduleContainer.appendChild(card);
      }
    };

    fetchSchedule();
  </script>
</body>
</html>
